using MaplePacketLib2.Tools;
using MapleServer2.Constants;
using MapleServer2.Packets;
using MapleServer2.Servers.Game;
using MapleServer2.Types;
using Microsoft.Extensions.Logging;
using System.Linq;

namespace MapleServer2.PacketHandlers.Game {
    public class FieldEnterHandler : GamePacketHandler {
        public override ushort OpCode => RecvOp.RESPONSE_FIELD_ENTER;

        public FieldEnterHandler(ILogger<FieldEnterHandler> logger) : base(logger) { }

        public override void Handle(GameSession session, PacketReader packet) {
            packet.ReadInt(); // ?

            // Liftable: 00 00 00 00 00
            // SendBreakable
            // Self
            session.EnterField(session.Player.MapId);
            session.Send(FieldObjectPacket.SetStats(session.FieldPlayer));
            session.Send(EmotePacket.LoadEmotes());

            // Normally skill layout would be loaded from a database
            QuickSlot arrowStream = QuickSlot.From(10600001);
            QuickSlot arrowBarrage = QuickSlot.From(90000074);
            QuickSlot eagleGlide = QuickSlot.From(10600081);
            QuickSlot testSkill = QuickSlot.From(10600181);

            if (session.Player.GameOptions.TryGetHotbar(0, out Hotbar mainHotbar)) {
                mainHotbar.MoveQuickSlot(0, QuickSlot.From(10000061));
                mainHotbar.MoveQuickSlot(1, QuickSlot.From(10000021));
                mainHotbar.MoveQuickSlot(2, QuickSlot.From(19999991));
                mainHotbar.MoveQuickSlot(3, QuickSlot.From(90200046));
                mainHotbar.MoveQuickSlot(4, arrowStream);
                mainHotbar.MoveQuickSlot(5, arrowBarrage);
                mainHotbar.MoveQuickSlot(6, eagleGlide);
                mainHotbar.MoveQuickSlot(7, testSkill);
                session.Send(KeyTablePacket.SendHotbars(session.Player.GameOptions));
            }

            return;

            int[] pigs = {
                // bunny 11300070,11300071,11300494,11300566,11300861,11300939,11300940,11300948,11300949,11300950,11301378,11320038,11320204,11600437,11600501,11600779,11600866,11600867,11600868,11610016,11620038,11620204,11620240,11700057,11700058,11700466,11700529,11700833,11700937,11700938,11700939,11710030,11720038,11720204,11720240,11820038,11850187,12200022,12200023,12200280,12200283,12200284,12200289,12200290,12200293,12200294,12200311,12200381,12200409,12200410,12200421,12200422,12200423,12200572,12220038,12220204,12220240
                //11300036,11300037,11300042,11300044,11300046,11300047,11300048,11300049,11300050,11300051,11300052,11300054,11300055,11300056,11300057,11300058,11300059,11300060,11300061,11300062,11300063,11300066,11300067,11300068,11300069,11300070,11300071,11300072,11300081,11300088,11300121,11300122,11300123,11300124,11300125,11300126,11300150,11300151,11300152,11300153,11300154,11300156,11300158,11300159,11300179,11300180,11300181,11300189,11300190,11300191,11300192,11300193,11300194,11300195,11300196,11300197,11300198,11300199,11300201,11300202,11300203,11300204,11300205,11300206,11300207,11300208,11300229,11300230,11300242,11300243,11300252,11300253,11300258,11300259,11300260,11300307,11300308,11300310,11300311,11300312,11300314,11300324,11300325,11300326,11300327,11300328,11300329,11300330,11300331,11300348,11300349,11300350,11300351,11300352,11300353,11300354,11300355,11300356,11300357,11300370,11300381,11300382,11300383,11300384,11300385,11300387,11300388,11300389,11300391,11300392,11300423,11300424,11300425,11300426,11300427,11300428,11300435,11300436,11300437,11300438,11300439,11300440,11300441,11300442,11300443,11300444,11300445,11300446,11300447,11300448,11300449,11300450,11300478,11300479,11300480,11300481,11300482,11300483,11300484,11300493,11300494,11300495,11300497,11300498,11300499,11300506,11300507,11300508,11300522,11300523
                //11300543,11300544,11300545,11300558,11300559,11300560,11300561,11300562,11300563,11300564,11300565,11300566,11300567,11300613,11300624,11300631,11300632,11300636,11300637,11300638,11300639,11300657,11300659,11300660,11300661,11300698,11300700,11300702,11300703,11300704,11300709,11300710,11300712,11300713,11300714,11300715,11300716,11300717,11300718,11300719,11300720,11300732,11300733,11300734,11300735,11300736,11300737,11300738,11300740,11300742,11300743,11300748,11300750,11300821,11300844,11300845,11300846,11300848,11300850,11300851,11300854,11300856,11300858,11300859,11300860,11300861,11300862,11300863,11300864,11300865,11300866,11300868,11300869,11300871,11300872,11300873,11300874,11300876,11300877,11300889,11300890,11300893,11300894,11300895,11300896,11300897,11300898,11300899,11300913,11300914,11300915,11300916,11300939,11300940,11300941,11300943,11300944,11300945,11300946,11300947,11300948,11300949,11300950,11300952,11300953,11300955,11301034,11301035,11301046,11301047,11301048,11301049,11301053,11301054,11301055,11301056,11301057,11301058,11301059,11301061,11301062,11301063,11301064,11301066,11301069,11301070,11301072,11301081,11301082,11301083,11301084,11301086,11301097,11301099,11301101,11301103,11301105,11301128,11301129,11301130,11301131,11301132,11301133,11301134,11301135,11301136,11301137,11301138,11301139,11301140
                //11301142,11301143,11301144,11301145,11301146,11301147,11301149,11301150,11301151,11301152,11301153,11301242,11301245,11301246,11301250,11301251,11301252,11301253,11301254,11301255,11301256,11301258,11301271,11301272,11301273,11301282,11301374,11301376,11301378,11301382,11301384,11301386,11301387,11301388,11301389,11301390,11301391,11301404,11301405,11301406,11301407,11301408,11301410,11301413,11301414,11301478,11301479,11301480,11301481,11301484,11301485,11301486,11301487,11301488,11301489,11301494,11301498,11301500,11301501,11301502,11301503,11301504,11301505,11301506,11301507,11301508,11301509,11301510,11301511,11301512,11301522,11301524,11301531,11301535,11301544,11301545,11301546,11301547,11301548,11301551,11304763,11304765,11304766,11304768,11304769,11304770,11304771,11304773,11304775,11304780,11304782,11304784,11304786,11304787,11304789,11304791,11304792,11304793,11304794,11304795,11304796,11304797,11304798,11304799,11304800,11304801,11304802,11304803,11304806,11304807,11304809,11304810,11304811,11304812,11304814,11304815,11304816,11304817,11304818,11304819,11304820,11304821,11304822,11304824,11304825,11304826,11304827,11304828,11304830,11304833,11304834,11304836,11304838,11304840,11304845,11304855,11310000,11310001,11320002,11320004,11320006,11320008,11320010,11320014,11320018,11320020,11320022,11320024,11320026,11320028
                //11320030,11320032,11320034,11320036,11320038,11320040,11320042,11320046,11320048,11320050,11320054,11320056,11320058,11320062,11320066,11320070,11320074,11320078,11320082,11320084,11320086,11320090,11320094,11320096,11320098,11320100,11320102,11320104,11320108,11320110,11320112,11320116,11320118,11320134,11320140,11320150,11320152,11320162,11320168,11320170,11320172,11320174,11320176,11320182,11320186,11320188,11320190,11320192,11320194,11320204,11320206,11320210,11320212,11320220,11320222,11320312,11320314,11320316,11320318,11320320,11320322,11320324,11320326,11320348,11320352,11320354,11320356,11320358,11320362,11320368,11320388,11320392,11320420,11361396,11361397,11361398,11361399,11600035,11600038,11600039,11600115,11600155,11600160,11600162,11600164,11600166,11600196,11600198,11600200,11600202,11600204,11600206,11600208,11600210,11600212,11600214,11600216,11600218,11600240,11600242,11600246,11600248,11600250,11600252,11600254,11600256,11600258,11600260,11600262,11600272,11600274,11600276,11600278,11600280,11600282,11600284,11600304,11600306,11600308,11600310,11600312,11600314,11600316,11600325,11600327,11600342,11600344,11600347,11600348,11600420,11600421,11600423,11600425,11600427,11600437,11600439,11600441,11600442,11600443,11600444,11600477,11600482,11600496,11600499,11600501,11600577,11600595,11600632,11600635,11600636
                //11600637,11600638,11600640,11600642,11600645,11600646,11600658,11600659,11600660,11600661,11600663,11600665,11600670,11600672,11600740,11600763,11600765,11600767,11600769,11600771,11600773,11600775,11600777,11600779,11600783,11600785,11600787,11600789,11600812,11600816,11600818,11600819,11600821,11600836,11600838,11600861,11600863,11600865,11600866,11600867,11600868,11600870,11600956,11600957,11600959,11600976,11600978,11600979,11600980,11600981,11600982,11600983,11600987,11600988,11600990,11601011,11601013,11601015,11601018,11601043,11601045,11601047,11601049,11601051,11601054,11601145,11601147,11601165,11601256,11601257,11601258,11601259,11601260,11601261,11601274,11601276,11601332,11601334,11601337,11601340,11601342,11601350,11601354,11604685,11604687,11604688,11604691,11604693,11604695,11604696,11604697,11604698,11604700,11604702,11604704,11604705,11610002,11610003,11610004,11610006,11610008,11610010,11610012,11610014,11610016,11610020,11610022,11610024,11610025,11610027,11610031,11610035,11610037,11610039,11620002,11620004,11620006,11620008,11620010,11620014,11620018,11620020,11620022,11620024,11620026,11620028,11620030,11620032,11620034,11620036,11620038,11620040,11620042,11620046,11620048,11620050,11620054,11620056,11620058,11620062,11620066,11620070,11620074,11620078,11620082,11620084,11620086,11620090,11620094,11620096
                //11620098,11620100,11620102,11620104,11620108,11620110,11620114,11620116,11620118,11620120,11620122,11620124,11620126,11620128,11620132,11620134,11620136,11620140,11620168,11620202,11620204,11620216,11620240,11620284,11620290,11620296,11620304,11620312,11620318,11620352,11620354,11620356,11620358,11620362,11620368,11620388,11620392,11620420,11700037,11700039,11700041,11700043,11700045,11700047,11700049,11700055,11700057,11700058,11700070,11700072,11700075,11700079,11700137,11700139,11700174,11700183,11700185,11700220,11700226,11700228,11700230,11700232,11700234,11700236,11700240,11700244,11700246,11700267,11700270,11700272,11700274,11700282,11700284,11700286,11700288,11700290,11700294,11700296,11700298,11700300,11700310,11700311,11700313,11700315,11700317,11700319,11700321,11700323,11700342,11700344,11700346,11700348,11700350,11700352,11700374,11700376,11700379,11700380,11700411,11700413,11700447,11700448,11700450,11700452,11700454,11700464,11700466,11700467,11700471,11700472,11700473,11700474,11700488,11700509,11700510,11700524,11700527,11700529,11700578,11700600,11700602,11700604,11700606,11700625,11700662,11700665,11700666,11700668,11700669,11700670,11700671,11700673,11700675,11700678,11700679,11700691,11700692,11700694,11700696,11700698,11700700,11700702,11700704,11700706,11700708,11700710,11700712,11700713,11700714,11700715
                //11700717,11700719,11700724,11700726,11700794,11700817,11700819,11700821,11700823,11700825,11700827,11700829,11700831,11700833,11700837,11700839,11700841,11700843,11700844,11700845,11700846,11700847,11700848,11700849,11700850,11700851,11700852,11700853,11700854,11700855,11700856,11700857,11700858,11700859,11700861,11700880,11700884,11700886,11700887,11700888,11700890,11700905,11700906,11700908,11700931,11700933,11700935,11700937,11700938,11700939,11701025,11701028,11701030,11701047,11701049,11701050,11701051,11701052,11701053,11701054,11701059,11701062,11701064,11701065,11701067,11701086,11701088,11701090,11701093,11701118,11701120,11701122,11701126,11701128,11701130,11701132,11701133,11701135,11701226,11701228,11701230,11701232,11701245,11701247,11701249,11701251,11701258,11701260,11701351,11701352,11701353,11701354,11701355,11701356,11701358,11701371,11701373,11701375,11701433,11701435,11701438,11701440,11701442,11701444,11701446,11701448,11701450,11701452,11701454,11701462,11701466,11701474,11710000,11710001,11710003,11710005,11710007,11710008,11710010,11710012,11710014,11710016,11710018,11710020,11710022,11710024,11710026,11710028,11710030,11710034,11710036,11710038,11710039,11710041,11710045,11710049,11710051,11710053,11720002,11720004,11720006,11720008,11720010,11720014,11720018,11720020,11720022,11720024,11720026,11720028
                //11720030,11720032,11720034,11720036,11720038,11720040,11720042,11720046,11720048,11720050,11720054,11720056,11720058,11720062,11720066,11720070,11720074,11720082,11720084,11720086,11720090,11720094,11720096,11720098,11720100,11720102,11720104,11720106,11720108,11720110,11720112,11720114,11720116,11720118,11720120,11720122,11720124,11720126,11720128,11720130,11720132,11720134,11720136,11720140,11720152,11720158,11720168,11720176,11720204,11720210,11720216,11720232,11720236,11720240,11720246,11720280,11720284,11720288,11720290,11720294,11720296,11720304,11720306,11720312,11720318,11720320,11720328,11720352,11720354,11720356,11720358,11720362,11720368,11720388,11720392,11720420,11790935,11790936,11790937,11790938,11790939,11790940,11790941,11790942,11790943,11790944,11790945,11800108,11800111,11800115,11800119,11800120,11800125,11800126,11800127,11800131,11800133,11800134,11800135,11800136,11800137,11800138,11800139,11800140,11800144,11820002,11820004,11820006,11820008,11820010,11820014,11820018,11820020,11820022,11820024,11820028,11820030,11820032,11820034,11820036,11820038,11820040,11820042,11820046,11820048,11820050,11820054,11820056,11820058,11820062,11820066,11820070,11820074,11820078,11820082,11820086,11820090,11820094,11820104,11820110,11820152,11820158,11820162,11820164,11820170,11820176,11820182,11820186,11820188,11820190
                //11820192,11820206,11820212,11820218,11820312,11820314,11820318,11820354,11820356,11820358,11820362,11820368,11820388,11820420,11850001,11850002,11850003,11850004,11850005,11850006,11850007,11850008,11850009,11850010,11850012,11850013,11850014,11850015,11850017,11850018,11850019,11850020,11850021,11850022,11850023,11850024,11850025,11850026,11850027,11850028,11850029,11850030,11850031,11850032,11850033,11850034,11850037,11850038,11850039,11850040,11850041,11850042,11850043,11850046,11850047,11850048,11850049,11850050,11850051,11850052,11850053,11850058,11850059,11850060,11850061,11850062,11850063,11850064,11850066,11850067,11850068,11850069,11850070,11850072,11850073,11850074,11850075,11850076,11850077,11850078,11850079,11850080,11850081,11850084,11850086,11850088,11850090,11850092,11850094,11850095,11850096,11850098,11850100,11850101,11850102,11850103,11850104,11850106,11850107,11850108,11850109,11850110,11850111,11850114,11850115,11850117,11850119,11850120,11850122,11850123,11850124,11850125,11850127,11850132,11850134,11850137,11850138,11850139,11850140,11850141,11850142,11850143,11850145,11850147,11850148,11850150,11850152,11850154,11850156,11850158,11850160,11850162,11850164,11850165,11850169,11850179,11850180,11850183,11850187,11850191,11850193,11850195,11850197,11850198,11850199,11850244,11850245,11850247,11850253,11850255
                //11850256,11850258,11850260,11850262,11850264,11850266,11860061,11860062,11860063,11860064,12200017,12200018,12200022,12200023,12200053,12200055,12200059,12200075,12200076,12200077,12200078,12200079,12200093,12200096,12200112,12200115,12200138,12200152,12200166,12200185,12200186,12200187,12200188,12200189,12200201,12200203,12200205,12200209,12200211,12200213,12200215,12200221,12200223,12200225,12200238,12200240,12200242,12200244,12200246,12200259,12200261,12200262,12200272,12200274,12200278,12200280,12200282,12200283,12200284,12200288,12200289,12200290,12200293,12200294,12200298,12200302,12200303,12200306,12200309,12200311,12200314,12200316,12200318,12200320,12200326,12200328,12200330,12200332,12200334,12200335,12200337,12200339,12200342,12200343,12200344,12200345,12200354,12200355,12200357,12200359,12200361,12200362,12200364,12200365,12200367,12200369,12200371,12200373,12200375,12200377,12200379,12200381,12200382,12200383,12200385,12200387,12200389,12200391,12200393,12200394,12200395,12200396,12200397,12200398,12200399,12200400,12200401,12200403,12200406,12200408,12200409,12200410,12200412,12200414,12200416,12200418,12200420,12200421,12200422,12200423,12200425,12200427,12200429,12200463,12200465,12200467,12200469,12200471,12200472,12200473,12200489,12200491,12200493,12200496,12200497,12200502,12200504,12200506,12200508,12200510
                //12200512,12200514,12200516,12200518,12200520,12200522,12200524,12200526,12200528,12200530,12200532,12200534,12200536,12200538,12200540,12200542,12200544,12200552,12200554,12200556,12200558,12200566,12200568,12200570,12200572,12200576,12200578,12200580,12200581,12200583,12200585,12200587,12200589,12200591,12200649,12200651,12200653,12200655,12200657,12200658,12200662,12200666,12200668,12200674,12200676,12200678,12200680,12200682,12200684,12200686,12200694,12200696,12200698,12200702,12200708,12220002,12220004,12220006,12220008,12220010,12220014,12220018,12220020,12220022,12220024,12220026,12220028,12220030,12220032,12220034,12220036,12220038,12220040,12220042,12220046,12220048,12220050,12220054,12220056,12220058,12220062,12220066,12220070,12220074,12220078,12220082,12220084,12220090,12220094,12220096,12220098,12220100,12220102,12220104,12220106,12220108,12220110,12220112,12220114,12220116,12220118,12220120,12220122,12220124,12220126,12220128,12220130,12220132,12220134,12220136,12220144,12220152,12220158,12220160,12220168,12220194,12220204,12220210,12220216,12220240,12220244,12220246,12220268,12220284,12220288,12220290,12220296,12220302,12220308,12220312,12220314,12220316,12220318,12220320,12220352,12220354,12220356,12220358,12220362,12220368,12220388,12220392,12220420
                // 乗り物
                //50600001,50600002,50600003,50600004,50600005,50600006,50600007,50600008,50600009,50600010,50600011,50600012,50600013,50600014,50600015,50600016,50600017,50600018,50600019,50600020,50600021,50600022,50600023,50600024,50600025,50600026,50600027,50600028,50600029,50600030,50600031,50600032,50600033,50600034,50600035,50600036,50600037,50600038,50600039,50600040,50600041,50600042,50600043,50600044,50600045,50600046,50600047,50600048
                //50600049,50600050,50600051,50600052,50600053,50600054,50600055,50600056,50600057,50600058,50600059,50600060,50600061,50600062,50600063,50600064,50600065,50600066,50600067,50600068,50600069,50600070,50600071,50600072,50600073,50600074,50600075,50600076,50600077,50600078,50600079,50600080,50600081,50600082,50600083,50600084,50600085,50600086,50600087,50600088,50600089,50600090,50600091,50600092,50600093,50600094,50600095,50600096
                //50600097,50600098,50600099,50600100,50600101,50600102,50600103,50600104,50600105,50600106,50600107,50600108,50600109,50600110,50600111,50600112,50600113,50600114,50600115,50600116,50600117,50600118,50600119,50600120,50600121,50600122,50600123,50600124,50600125,50600126,50600127,50600128,50600129,50600130,50600131,50600132,50600133,50600134,50600135,50600136,50600137,50600138,50600139,50600140,50600141,50600142,50600143,50600144
                //50600145,50600146,50600147,50600148,50600149,50600150,50600151,50600152,50600153,50600155,50600156,50600157,50600158,50600159,50600160,50600161,50600162,50600163,50600164,50600165,50600166,50600167,50600168,50600169,50600170,50600171,50600172,50600173,50600174,50600175,50600176,50600177,50600178,50600179,50600180,50600181,50600182,50600183,50600184,50600185,50600186,50600187,50600188,50600189,50600190,50600191,50600192,50600193
                //50600194,50600195,50600196,50600197,50600198,50600199,50600201,50600202,50600203,50600204,50600205,50600206,50600207,50600208,50600209,50600210,50600211,50600213,50600214,50600215,50600216,50600217,50600218,50600219,50600220,50600221,50600222,50600223,50600224,50600225,50600226,50600227,50600228,50600229,50600230,50600231,50600232,50600233,50600234,50600236,50600237,50600238,50600240,50600241,50600242,50600243,50600244,50600245
                50600246,50600247,50600248,50600249,50600250,50600251,50600252,50600253,50600254,50600255,50600256,50600257,50600258,50600260,50600261,50600262,50600267,50600268,50600269,50600270,50600271,50600274,50600276,50600278,50600279,50600280,50600281,50600282,50600284,50600285,50600289,50600290,50600291,50600292,50600293,50600294,50600295,50600296,50600297,50600298,50600299,50600301,50600305,50600306,50600309,50600314,50600316,50600317
                //50600318,50600319,50600320,50600321,50600322,50600323,50600324,50600325,50600327,50600328,50600329,50600330,50600331,50600333,50600334

            };

            int[] ex = { 50600211, 50600196, 50600162, 10200042, 12200028, 12200057 };
            foreach (var pig in pigs)
            {
                try
                {
                    if(null == Data.Static.ItemMetadataStorage.GetMetadata(pig))
                    {
                        continue;
                    }
                }
                catch
                {
                    continue;
                }

                if (ex.Where(x => x == pig).Any())
                    continue;
                var crown = new Item(pig) { Uid = pig };
                session.Inventory.Add(crown);
                session.Send(ItemInventoryPacket.Add(crown));
            }

            // Add catalysts for testing
            int[] catalysts = { 40100001, 40100002, 40100003, 40100021, 40100023, 40100024, 40100026 };
            foreach (int catalyst in catalysts) {
                var item = new Item(catalyst) { Amount = 99999, Uid = catalyst };
                session.Inventory.Add(item);
                session.Send(ItemInventoryPacket.Add(item));
            }
        }
    }
}